select CASE WHEN TRDre.VentureCat1 IN ('Digital Goods','Special Digital Products') THEN 'Digital Goods - Only' WHEN TRDre.VentureCat1 IN ('Special Digital Products') THEN 'Special Digital Goods - topup/cards' WHEN TRDre.VentureCat1 IN ('Cameras','Computers & Laptops','Home Appliances','Mobiles & Tablets','TV, Audio / Video, Gaming & Wearables') THEN 'Electronics' WHEN TRDre.VentureCat1 IN ('Bags and Travel','Fashion','Watches Sunglasses Jewellery') THEN 'Fashion' WHEN TRDre.VentureCat1 IN ('Groceries','Health & Beauty','Medicine','Mother & Baby','Pet Supplies') THEN 'FMCG' WHEN TRDre.VentureCat1 IN ('Bedding & Bath','Charity and Donation','Furniture & Decor','Kitchen & Dining','Laundry & Cleaning','Media, Music & Books','Motors','Packaging Material','Sports & Outdoors','Stationery & Craft','Tools, DIY & Outdoor','Toys & Games') THEN 'Lifestyle' ELSE 'Other' END Industry, Trdre.VentureCat1, Trdre.VentureCat2, Trdre.VentureCat3, Sum(FinRe.revenue_) as Revenue, Sum(FinRe.COGS_) as COGS, sum(Finre.Margin_per) as Margin_ from (SELECT sales_order_item_id ,AVG(unit_price) as unit_price_ ,AVG(revenue) as revenue_ ,sum(revenue) as revenue_sum ,AVG(cost_with_fifo) as COGS_ ,sum(cost_with_fifo) as COGS_sum ,AVG(margin_per) as Margin_per ,sum(margin_per) as Margin_per_sum from daraz_ads.ads_drz_monetization_consolidated_cogs_mtd_df where venture ="BD" group BY sales_order_item_id ) as FinRe inner join (select TO_CHAR(delivery_communicate_date,"yyyymmdd") AS Date_Delivery_Date, sales_order_item_id, sales_order_id, order_number, industry_name as industryName, venture_category1_name_en as VentureCat1, venture_category2_name_en as VentureCat2, venture_category3_name_en as VentureCat3, exchange_rate, shipping_type, business_area, item_status_esm, product_name, (shipping_amount) as Shipping_amount, (shipping_discount_amount) as Shipping_discount_amount, (shipping_surcharge_amount) as Shipping_surcharge_amount, (shipping_amount_total) as Shipping_amount_total, discount_amount_by_platform, collectible_discount_amount_platform, shipping_discount_amount_platform, voucher_discount_amount_platform, shipping_fee_discount_amount_platform, loyalty_shipping_fee_discount_amount_platform, promotion_discount_amount_platform, paymentinstantoff_discount_amount_platform, paymentcoupon_discount_amount_platform, bundle_discount_amount_platform, shop_account_code FROM daraz_cdm.dwd_drz_trd_core_df_bd where ds = TO_CHAR(DATEADD(GETDATE(),-1,'dd'),'YYYYMMDD') and venture = 'BD' and seller_id ='1000000' and TO_CHAR(delivery_date,"yyyymmdd") BETWEEN '20230501' and '20230532' AND brand_name IN ('LOCALÃ‰','Staples House') and unit_price >1 and item_status_esm not in ('invalid','rejected','cancelled','return_refunded') ) as TrdRe on FinRe.sales_order_item_id = TrdRe.sales_order_item_id Group BY Trdre.VentureCat1, Trdre.VentureCat2, Trdre.VentureCat3
